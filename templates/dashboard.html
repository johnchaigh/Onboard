{% extends "layout.html" %}

{% block title %}
Dashboard
{% endblock %}

{% block main %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>

<div class="homepagebackground">
  <div class="uk-card-small uk-padding uk-padding-medium">
    <h2 class="uk-text-center uk-text uk-text-lighter">Dashboard</h2>
    <div class="uk-card uk-card-default uk-card-body uk-grid-column-small uk-grid-row-small uk-child-width-1-3@s uk-text-center" uk-grid>
        <div>
            <div><a href="/people"><img src="static/images/opportunity.svg" alt="piechart"class="icon"></a>
            <p class="uk-text uk-text-light">People</p>
          </div>
        </div>
        <div>
            <div><a href="/pathways"><img src="static/images/rocket-launch.svg" alt="piechart"class="icon"></a>
              <p class="uk-text uk-text-light">Pathways</p>
              </div>
        </div>
        <div>
            <div><a href="/report"><img src="static/images/pie-chart.svg" alt="piechart"class="icon"></a>
              <p class="uk-text uk-text-light">Reports</p>
              </div>
        </div>
    </div>

 {% if colours is defined %}

  <div  class="uk-padding" uk-filter="target: .js-filter">
    <ul class="uk-subnav uk-subnav-pill uk-text-center" id="center">
        <li class="uk-active" uk-filter-control><a href="#">All</a></li>
        <li uk-filter-control="[data-color='business']"><a href="#">Business Performance</a></li>
        <li uk-filter-control="[data-color='progress']"><a href="#">Pathway Performance</a></li>
        <li uk-filter-control="[data-color='preappointment']"><a href="#">Pre Appointment</a></li>
    </ul>

    <ul class="js-filter uk-grid-small uk-child-width-1-2@s uk-flex uk-text-center" uk-grid>

        <li data-color="business">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Total Business: £{{ totalbusiness }}<p>
              <canvas id="incomechart1"></canvas>

               <script>

                  var incomechart1 = document.getElementById("incomechart1");

                  var income = {
                    labels: {{ names | safe }},
                    datasets: [{
                      data: {{ incomedata }},
                      backgroundColor: {{ colours | safe }},
                    }]
                  };

                  var chartOptions = {
                    startAngle: -Math.PI / 4,
                    legend: {
                      position: 'right'
                    },
                    animation: {
                      animateRotate: true,
                      duration: 600,
                      easing: 'linear',
                    }

                };

                var polarAreaChart = new Chart(incomechart1, {
                  type: 'polarArea',
                  data: income,
                  options: chartOptions
                });

              </script>
            </div>
        </li>

        <li data-color="progress">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Distribution of People<p>
              <canvas id="pathwaychart1"></canvas>
               <script>
                 var ctx = document.getElementById("pathwaychart1").getContext('2d');
                  var myChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                      labels: {{ pathwaynames | safe }},
                      datasets: [{
                        backgroundColor: {{ colours | safe }},
                        data: {{ pathwaynumbers | safe }}
                      }]
                    },
                    options: {
                        legend:{
                          position: 'bottom',
                              }
                            }
                          });

              </script>
            </div>
        </li>

        <li data-color="progress">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Days in Pathway<p>
                <canvas id="longestinpathway"></canvas>
                <script>


                var longestinpathwayCxt = document.getElementById("longestinpathway").getContext("2d");
                var longestinpathwayData = {
                    labels: {{ names | safe }},
                    datasets: [{
                        label: ['Days in pathway'],
                        data: {{ longestinpathwaydaysin | safe }},
                        backgroundColor: {{ colours | safe }},
                    }]
                };

                var longestinpathway = new Chart(longestinpathwayCxt, {
                    type: 'horizontalBar',
                    data: longestinpathwayData,
                    options: {
                      legend: {display: false},
                        scales: {
                            xAxes: [{
                                ticks: {
                            		min: 0
                                }
                            }],
                        }

                    }
                });
                </script>
            </div>
        </li>

        <li data-color="business">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Sales Performance Against Target<p>
                <canvas id="targetperformance"></canvas>
                <script>


                var targetperformanceCxt = document.getElementById("targetperformance").getContext("2d");
                var longestinpathwayData = {
                    labels: {{ names | safe }},
                    datasets: [{
                        label: ['Performance on target £'],
                        data: {{ targetperformance | safe }},
                        backgroundColor: {{ colours | safe }},
                    }]
                };

                var targetperformance = new Chart(targetperformanceCxt, {
                    type: 'bar',
                    data: longestinpathwayData,
                    options: {
                      legend: {display: false},
                        scales: {
                            xAxes: [{
                                ticks: {
                            		min: 0
                                }
                            }],
                        }

                    }
                });
                </script>
            </div>
        </li>

        <li data-color="progress">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Score<p>
                <canvas id="topprogression"></canvas>
                <script>

                var topprogressionCxt = document.getElementById("topprogression").getContext("2d");
                var topprogressionData = {
                    labels: {{ names | safe }},
                    datasets: [{
                        label: ['Score'],
                        data: {{ score | safe }},
                        backgroundColor: {{ colours | safe }},
                    }]
                };

                var topprogression = new Chart(topprogressionCxt, {
                    type: 'bar',
                    data: topprogressionData,
                    options: {
                      legend: {display: false},
                        scales: {
                            yAxes: [{
                                ticks: {
                            		min: 0
                                }
                            }],
                        }

                    }
                });
                </script>
            </div>
        </li>

        <li data-color="progress">
            <div class="uk-card uk-card-default uk-card-body">
              <p class="uk-text uk-text-lighter">Time / Progress<p>
                  <canvas id="myChart1"></canvas>
                   <script>
                   new Chart.Scatter(document.getElementById("myChart1"), {
                   type: 'scatter',
                   data: {
                     labels: {{ names | safe }},
                     datasets: [{
                       data: {{ scatterdata | safe }},
                       showLine: false,
                       fill: true,
                       tension: 0.4,
                       borderColor: 'blue',
                       borderWidth: 1,
                       borderColor: "white",
                       backgroundColor: "rgba(0, 137, 255, 0.4)",
                       opacity: .1,
                       pointBackgroundColor: {{ colours | safe }},
                       pointBorderColor: 'white',
                       pointRadius: 8,
                       pointHoverRadius: 9,
                       spanGaps: true,
                       trendlineLinear: {
                                style: "rgb(43 ,66 ,255, 0.3)",
                                lineStyle: "solid",
                                width: 1
                              }
                     },],
                   },
                   options: {
                     animation: {
                      easing: 'easeInOutQuad',
                      duration: 400
                    },
                    spanGaps: true,
                     tooltips: {
                       mode: 'index',
                       intersect: false,
                       callbacks: {
                               title: function(tooltipItem, data) {
                         return data['labels'][tooltipItem[0]['index']];},
                                 label: function(tooltipItem) {
                                   return + Number(tooltipItem.yLabel) + " days in pathway" +', '+ Number(tooltipItem.xLabel)+"% complete";
                                 }
                             }
                         },
                            responsive: true,
                            legend: {display: false},
                      scales: {
                          xAxes: [{
                                  display: true,
                                  ticks: {
                                      beginAtZero: true,
                                      steps: 10,
                                      stepValue: 5,
                                      max: 100
                                      },
                                    scaleLabel: {
                                        display: true,
                                        labelString: '% Progress'
                                    }
                                }],
                          yAxes: [{
                                  display: true,
                                  ticks: {
                                      beginAtZero: true,

                                      },
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Days in Pathway'
                                          }
                                      }],
                            },
                            showLines: true
                          }
                   });
                  </script>
            </div>
        </li>

        <li data-color="preappointment">

          <div class="uk-card uk-card-default uk-card-body">
            <p class="uk-text uk-text-lighter">Steps Remaining Before Appointment<p>
              <canvas id="stepsremain"></canvas>
              <script>


              var stepsremainCxt = document.getElementById("stepsremain").getContext("2d");
              var stepsremainData = {
                  labels: {{ stepsremainnames | safe }},
                  datasets: [{
                      label: ['stepsremain'],
                      data: {{ stepsremain | safe }},
                      backgroundColor: {{ colours | safe }},

                  }]
              };

              var stepsremain = new Chart(stepsremainCxt, {
                  type: 'bar',
                  data: stepsremainData,
                  options: {
                    legend: {display: false},
                      scales: {
                          yAxes: [{
                              ticks: {
                              min: 0
                              }
                          }],
                      }

                  }
              });
              </script>
          </div>
      </li>

    </ul>
{% endif %}

</div>
</div>


  {% endblock %}
