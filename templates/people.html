{% extends "layout.html" %}

{% block title %}
People
{% endblock %}

{% block main %}

<div class="uk-card uk-card-default uk-card-small">
  <div class="uk-text-center uk-card-body">
    <h1 class="uk-text uk-text-lighter">People</h1>
  </div>

<div id="scatter" style="padding-left: 10px; padding-right: 30px; padding-bottom: 80px">

  <canvas id="myChart1" height="150px"></canvas>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>
   <script>
   new Chart.Scatter(document.getElementById("myChart1"), {
   type: 'bubble',
   data: {
     labels: {{ labels | safe }},
     datasets: [{
       data: {{ data | safe }},
       showLine: false,
       fill: true,
       tension: 0.4,
       borderColor: 'blue',
       borderWidth: 1,
       borderColor: "white",
       backgroundColor: "rgba(0, 137, 255, 0.4)",
       opacity: .1,
       pointBackgroundColor: {{bubblecolour | safe}},
       pointBorderColor: 'white',
       pointRadius: 8,
       pointHoverRadius: 9,
       spanGaps: true,
       trendlineLinear: {
                style: "rgb(43 ,66 ,255, 0.3)",
                lineStyle: "solid",
                width: 2
              }
     },],
   },
   options: {
     animation: {
      easing: 'easeInOutQuad',
      duration: 400
    },
    spanGaps: true,
     tooltips: {
       mode: 'index',
       intersect: false,
       callbacks: {
               title: function(tooltipItem, data) {
         return data['labels'][tooltipItem[0]['index']];},
                 label: function(tooltipItem) {
                   return + Number(tooltipItem.yLabel) + " days since appointment" +', '+ Number(tooltipItem.xLabel)+"% complete";
                 }
             }
         },
            responsive: true,
            legend: {display: false},
      scales: {
          xAxes: [{
                  display: true,
                  ticks: {
                      beginAtZero: true,
                      steps: 10,
                      stepValue: 5,
                      max: 100
                      },
                    scaleLabel: {
                        display: true,
                        labelString: '% Progress'
                    }
                }],
          yAxes: [{
                  display: true,
                  ticks: {
                      beginAtZero: true,

                      },
                    scaleLabel: {
                        display: true,
                        labelString: 'Days Since Appointment'
                          }
                      }],
            },
            showLines: true

          }
   });
  </script>
</div>

<div class="uk-card uk-card-default uk-card-small">
  <div class="uk-text-center uk-card-body">
    <h2 class="uk-text uk-text-lighter">Appointed</h2>
  </div>

    <table class="uk-table uk-table-middle uk-table-divider uk-text uk-text-lighter">
      <thead>
        <th><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="name" name='sort'>Name</button></form></th>
        <th><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="pathway" name='sort'>Pathway</button></form></th>
        <th style="text-align: center; vertical-align: middle;"><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="progress" name='sort'>Progress</button></form></th>
        <th style="text-align: center; vertical-align: middle;">Date Appointed</th>
        <th style="text-align: center; vertical-align: middle;"><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="days" name='sort'>Days since appointment</button></form></th>
        <th style="text-align: center; vertical-align: middle;">Est Graduation</th>
        <th style="text-align: center; vertical-align: middle;"><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="score" name='sort'>Score</button></form></th>

      </thead>
      {% for appointed in appointed %}
      <tr>
        <td><a href="/viewperson?name={{appointed['email']}}"><small>{{appointed['firstname']}} {{appointed['lastname']}}</small></a></td>
        <td><a href="/progress?name={{appointed["email"]}}&pathway={{appointed['pathwayEnrolled']}}"><small>{{appointed['pathwayEnrolled']}}</small></a></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{appointed['pathwayEnrolledProgress']}}%</small></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{appointed['dateappointed']}}</small></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{appointed['dayssinceappointment']}}</small></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{appointed['estcompletion']}}</small></td>
        {% if appointed['businessWrittenYearToDate'] >= (appointed['dayssinceappointment'] * 165) %}
          <td uk-tooltip="title: £{{appointed['businessWrittenYearToDate'] - (appointed['dayssinceappointment'] * 165)}} above target" style="text-align: center; vertical-align: middle;"><span class="badge badge-pill badge-primary">{{appointed['score']}}</span></td>
        {% else %}
          <td uk-tooltip="title: £{{appointed['businessWrittenYearToDate'] - (appointed['dayssinceappointment'] * 165)}} short of target" style="text-align: center; vertical-align: middle;"><span class="badge badge-pill badge-danger">{{appointed['score']}}</span></td>
        {% endif %}
      </tr>
      {% endfor %}
    </table>
</div>

<div class="uk-card uk-card-default uk-card-small">
  <div class="uk-text-center uk-card-body">
    <h2 class="uk-text uk-text-lighter">Pre Appointment</h2>
  </div>
    <table class="uk-table uk-table-middle uk-table-divider uk-text uk-text-lighter">
      <thead>
        <th><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="name" name='sort'>Name</button></form></th>
        <th><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="pathway" name='sort'>Pathway</button></form></th>
        <th style="text-align: center; vertical-align: middle;"><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="progress" name='sort'>Stages until Appointment</button></form></th>
        <th style="text-align: center; vertical-align: middle;">Enrolled</th>
        <th style="text-align: center; vertical-align: middle;"><form action='/people' method='post'><button type='submit' class="uk-button uk-button-link" value="days" name='sort'>Days Enrolled</button></form></th>
      </thead>
      {% for preappointment in preappointment %}
      <tr>
        <td><a href="/viewperson?name={{preappointment['email']}}"><small>{{preappointment['firstname']}} {{preappointment['lastname']}}</small></a></td>
        <td><a href="/progress?name={{preappointment["email"]}}&pathway={{preappointment['pathwayEnrolled']}}"><small>{{preappointment['pathwayEnrolled']}}</small></a></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{preappointment['pathwayEnrolledProgress']}}</small></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{preappointment['pathwayEnrolledDate']}}</small></td>
        <td style="text-align: center; vertical-align: middle;"><small>{{preappointment['daysinpathway']}}</small></td>
      </tr>
      {% endfor %}
    </table>


  </div>
  <div id="center">
    <a href="/newperson" uk-icon="icon: plus; ratio: 2"></a>
  </div>

</div>

{% endblock %}
